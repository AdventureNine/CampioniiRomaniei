#:import AppColors frontend.utils.colors.AppColors
#:import hex kivy.utils.get_color_from_hex

<MapGuessScreen>:
    # Legătura id-urilor
    map_container: pins_layer

    canvas:
        Color:
            rgba: AppColors.BACKGROUND
        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:
        # 1. Header (Sus de tot)
        StandardHeader:
            title: "Găsește pe Hartă"
            pos_hint: {'top': 1}
            back_screen: 'region_dashboard'

        # 2. Layout Principal (Sub header)
        BoxLayout:
            orientation: 'horizontal'
            size_hint: 0.95, 0.85
            pos_hint: {'center_x': 0.5, 'y': 0.02}
            spacing: 20

            # --- PARTEA STÂNGĂ (Text și Instrucțiuni) ---
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.3
                padding: 10
                spacing: 20

                Label:
                    text: root.main_question
                    font_size: '22sp'
                    color: AppColors.TEXT_PRIMARY
                    text_size: self.width, None
                    size_hint_y: None
                    height: 100
                    halign: 'left'
                    valign: 'top'

                Label:
                    text: root.current_target_text
                    font_size: '26sp'
                    bold: True
                    color: AppColors.WHITE
                    text_size: self.width - 20, None
                    halign: 'center'
                    valign: 'middle'

                    canvas.before:
                        Color:
                            rgba: AppColors.ACCENT
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [15,]

                Widget:

            RelativeLayout:
                size_hint_x: 0.7

                RelativeLayout:
                    id: map_area
                    # Harta stă în interiorul chenarului, cu puțin padding
                    size_hint: 0.96, 0.96
                    pos_hint: {'center_x': 0.5, 'center_y': 0.5}

                    Image:
                        source: root.bg_image
                        fit_mode: "fill"
                        size_hint: 1, 1
                        pos_hint: {'x': 0, 'y': 0}

                    FloatLayout:
                        id: pins_layer
                        size_hint: 1, 1
                        pos_hint: {'x': 0, 'y': 0}

                    # Widget Invizibil pentru Touch
                    Widget:
                        size_hint: 1, 1
                        pos_hint: {'x': 0, 'y': 0}
                        on_touch_up: if self.collide_point(*args[1].pos): root.on_map_touch(args[1])
        ToggleButton:
            text: "Mod Calibrare: OFF" if self.state == 'normal' else "Mod Calibrare: ON"
            size_hint: None, None
            size: 200, 50
            pos_hint: {'right': 0.98, 'y': 0.02} # Dreapta jos
            background_color: (1, 0, 0, 1) if self.state == 'down' else (0.5, 0.5, 0.5, 1)
            on_state: root.debug_mode = (self.state == 'down')