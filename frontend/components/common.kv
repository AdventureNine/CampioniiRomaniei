#:import hex kivy.utils.get_color_from_hex
#:import AppColors frontend.utils.colors.AppColors

<IconButton@ButtonBehavior+Image>:
    size_hint: None, None
    fit_mode: "contain"

# --- WIDGET TIMER ---
<TimerDisplay@BoxLayout>:
    size_hint: None, None
    size: 160, 50
    padding: [10, 5]
    spacing: 5

    opacity: 1 if app.timer_text else 0

    canvas.before:
        Color:
            rgba: (0, 0, 0, 0.2)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [15,]

    Label:
        text: app.timer_text
        font_size: '20sp'
        bold: True
        color: hex('#FFEB3B')
        valign: 'middle'
        halign: 'left'
        text_size: self.width, None
        pos_hint: {'center_y': 0.5}

    Image:
        source: root.timer_image
        size_hint: None, 1
        width: 50
        fit_mode: "contain"
        pos_hint: {'center_y': 0.5}

# --- WIDGET SCOR ---
<ScoreDisplay>:
    size_hint: None, None
    size: 150, 50
    padding: [15, 5]
    spacing: 5

    canvas.before:
        Color:
            rgba: (0, 0, 0, 0.2)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [15,]

    # Textul scorului (Stânga)
    Label:
        text: str(app.score) if hasattr(app, 'score') else "0"
        font_size: '20sp'
        bold: True
        color: hex('#FFEB3B')
        valign: 'middle'
        halign: 'right'
        text_size: self.width, None
        size_hint_x: 1
        pos_hint: {'center_y': 0.5}

    # Iconița (Dreapta)
    Image:
        source: root.coin_image
        size_hint: None, 1
        width: 30
        fit_mode: "contain"
        pos_hint: {'center_y': 0.5}

# --- HEADER STANDARD ---
<StandardHeader>:
    size_hint_y: None
    height: 80

    header_color: AppColors.PRIMARY

    canvas.before:
        Color:
            rgba: root.header_color[0], root.header_color[1], root.header_color[2], 0.85
        Rectangle:
            pos: self.pos
            size: self.size

    # --- 1. BUTONUL DE ÎNAPOI ---
    IconButton:
        source: root.back_image

        size: 200, 200
        pos_hint: {'x': 0.02, 'center_y': 0.5}

        opacity: 1 if root.show_back_button else 0
        disabled: not root.show_back_button
        on_release: app.clouds.change_screen(root.back_screen) if hasattr(app, 'clouds') else None

    # --- 2. TITLUL  ---
    Label:
        text: root.title
        font_size: '26sp'
        bold: True
        color: AppColors.WHITE

        halign: 'center'
        valign: 'middle'
        text_size: self.width, None

        size_hint: 0.6, 1
        pos_hint: {'center_x': 0.7, 'center_y': 0.5}

    # --- 3. ZONA DREAPTĂ (Timer + Scor) ---
    BoxLayout:
        size_hint: None, 1
        width: 350
        spacing: 20
        orientation: 'horizontal'

        pos_hint: {'right': 0.9, 'center_y': 0.7}

        # 1. Componenta Timer (
        TimerDisplay:

        # 2. Componenta Scor
        ScoreDisplay:

# --- POPUP FEEDBACK ---
<FeedbackPopup>:
    BoxLayout:
        orientation: 'vertical'
        padding: 30
        spacing: 20
        canvas.before:
            Color:
                rgba: AppColors.SUCCESS if root.type == 'success' else (AppColors.ERROR if root.type == 'fail' else AppColors.INFO)
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [20,]

        Label:
            text: root.title_text
            font_size: '36sp'
            bold: True
            size_hint_y: 0.3
            color: AppColors.WHITE

        Label:
            text: root.message_text
            font_size: '24sp'
            halign: 'center'
            valign: 'middle'
            text_size: self.width - 40, None
            color: AppColors.WHITE

        Button:
            text: root.button_text
            size_hint: None, None
            size: 200, 60
            pos_hint: {'center_x': 0.5}
            background_normal: ''
            background_color: (1, 1, 1, 0.3)
            font_size: '22sp'
            bold: True
            on_release: root.dismiss()

# --- BUTON RĂSPUNS QUIZ  ---
<AnswerButton>:
    background_normal: ''
    background_color: AppColors.BACKGROUND
    color: AppColors.TEXT_PRIMARY
    font_size: '20sp'
    bold: True
    text_size: self.width - 20, None
    halign: 'center'
    valign: 'middle'
    canvas.before:
        Color:
            rgba: self.background_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [15,]
        Color:
            rgba: AppColors.PRIMARY
        Line:
            rounded_rectangle: (self.x, self.y, self.width, self.height, 15)
            width: 2
    background_down: ''